#!/bin/bash
#
# quick open files using dmenu
#
# req: dmenu, xdg-open
#

function usage() {
cat <<EOF
usage:
    $0 [-m mask] [-u program] /path/to/dir

example:
    $0 -m "*.txt" -u gvim $HOME/Documents
EOF
}

mask="*"
program=xdg-open
while getopts ":m:u:h" o; do
  case $o in
    m)
        mask=$OPTARG
        ;;
    u)
        program=$OPTARG
        ;;
    h)
        usage
        exit 0
        ;;
    \?)
      echo "Invalid option: -$OPTARG" >&2
      exit 1
      ;;
    :)
      echo "Option -$OPTARG requires an argument." >&2
      exit 1
      ;;
    esac
done
shift $((OPTIND-1))

folder=$1
if [ -z "$folder" ]; then
    usage
    exit 1
fi
if [ ! -d "$folder" ]; then
    echo "$folder is not a directory"
    exit 2
fi

cd "$folder"
selection=$(ls --color=never -1 $mask | dmenu -p "$folder")
if [ -n "$selection" ]; then
    $program "$selection"
fi

