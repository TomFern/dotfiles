#!/usr/bin/env bash

function usage () {
    echo "Usage :  $0 [OPTIONS] FILE
    Convert text files to GitHub markdown and preview them

    Packages required:
        - python-grip
        - entr
        - pandoc
        - xdg-open

    Options:
        -f FMT        Input format (default=org)
        -h|help       Display this message
    "
}

SW_f=org
while getopts ":f:h" opt
do
  case $opt in
      f) SW_f=$OPTARG;;
      h|help     )  usage; exit 0   ;;
      * )  echo -e "\n  Option does not exist : $opt\n"
          usage; exit 1   ;;
  esac
done
shift $(($OPTIND-1))
OTHERARGS=$@

INPUT_FN=$1
if [ -z "$INPUT_FN" ]; then
    usage
    exit 0
fi

if [ ! -f "$INPUT_FN" ]; then
    echo ":: No such file: $INPUT_FN"
    exit 1
fi

killall grip 2>/dev/null
sleep 1
touch review.md
grip review.md &
# xdg-open http://localhost:6419 &

echo "$INPUT_FN" | entr pandoc -f $SW_f -t gfm "$INPUT_FN" -o review.md 
