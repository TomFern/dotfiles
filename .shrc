# ~/.shrc
# --------
# common bash-like rc

# environment {{{

export LANG=en_US.UTF-8
export LC_CTYPE=en_US.UTF-8
export LC_TIME=en_US.UTF-8
export LC_COLLATE=en_US.UTF-8

export BROWSER=firefox
export EDITOR=vim
export PAGER=less
export PATH=$HOME/dotfiles/bin:/usr/local/bin:$PATH
export S_COLORS=auto

# MullVPN
alias chrome-vpn="/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome  --proxy-server=socks5://10.64.0.1"

# ruby brew
if [ -d "/opt/homebrew/opt/ruby/bin" ]; then
  export PATH=/opt/homebrew/opt/ruby/bin:$PATH
  export PATH=`gem environment gemdir`/bin:$PATH
fi

# rvm
# if [ -d "$HOME/.rvm" ]; then
#     export PATH="$PATH:$HOME/.rvm/bin"
#     if [ -s "$HOME/.rvm/scripts/rvm" ]; then
#         source "$HOME/.rvm/scripts/rvm" 
#     fi
# fi

# rust
if [ -d "$HOME/.cargo/bin" ]; then
    export PATH="$PATH:$HOME/.cargo/bin"
fi

# bun completions
[ -s "/Users/tom/.bun/_bun" ] && source "/Users/tom/.bun/_bun"

# homebrew
if [ -r /opt/homebrew/bin/brew ]; then
      eval "$(/opt/homebrew/bin/brew shellenv)"
fi

# php
export PATH="/opt/homebrew/opt/php@7.4/sbin:$PATH"
export PATH="/opt/homebrew/opt/php@7.4/bin:$PATH"

# bun completions

# Bun
export BUN_INSTALL="/Users/tom/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"
[ -s "/Users/tom/.bun/_bun" ] && source "/Users/tom/.bun/_bun"

# deno
export DENO_INSTALL="/Users/tom/.deno"
export PATH="$DENO_INSTALL/bin:$PATH"

# kiex manages elixir version (install https://github.com/taylor/kiex) 
if [ -s "$HOME/.kiex/scripts/kiex" ]; then
    source "$HOME/.kiex/scripts/kiex"
fi

# Timezone
# export TZ='America/Argentina/Buenos_Aires'

# gnu GPG agent
export GPG_AGENT_INFO_FILE=$HOME/.gnupg/gpg-agent-info
if [ -f "$GPG_AGENT_INFO_FILE" ]; then
    . "$GPG_AGENT_INFO_FILE"
    export GPG_TTY=$(tty)
    export GPG_AGENT_INFO
    export SSH_AUTH_SOCK
    export SSH_AGENT_PID
fi

# docker use linux platform by default
export DOCKER_DEFAULT_PLATFORM=linux/amd64

# java
export _JAVA_OPTIONS='-Dawt.useSystemAAFontSettings=gasp'

# }}}
# macos {{{

export NVM_DIR="$HOME/.nvm"
[  -d "$NVM_DIR" ] || mkdir -p "$NVM_DIR"
[ -s "/opt/homebrew/opt/nvm/nvm.sh" ] && . "/opt/homebrew/opt/nvm/nvm.sh"  # This loads nvm
[ -s "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm" ] && . "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm"  # This loads nvm bash_completion

# [ -f /opt/homebrew/opt/asdf/libexec/asdf.sh ] && . /opt/homebrew/opt/asdf/libexec/asdf.sh

# }}}

# aliases {{{
alias vim=nvim
alias vi=nvim
alias v=nvim
alias l='ls -ltra'
# alias S="sudo systemctl"
# alias gp='ps aux | grep -v grep | grep -i'
# alias lo='libreoffice'
# alias turn-off='xset -display :0.0 dpms force off'
alias en=su
alias g=git
alias GG="git commit -m u && git push"
alias listen="lsof -nP +c 15 | grep LISTEN"

alias cu='curl -w "\n"'
alias dk=docker
alias dk-rm='docker ps --filter status=dead --filter status=exited --filter status=created -aq | xargs docker rm -v'
alias dk-volume-clean="docker volume ls -qf dangling=true | xargs -r docker volume rm -v"
alias dk-image-clean="docker images --no-trunc | grep '<none>' | awk '{ print $3 }' | xargs -r docker rmi"
# alias dk-umount="umount -l $(grep 'aufs' /proc/mounts | awk '{print$2}' | sort -r)"
alias k=kubectl
# alias ka="kubectl apply -f -"
# alias dk-delete-all-images="docker system prune && docker rmi -f $(docker images -a -q)"

# nocache
# if which nocache >/dev/null 2>&1; then
#     alias cp='nocache cp -i'
#     alias mv='nocache mv -i'
#     alias rm='nocache rm -i'
# fi


# systemctl user mode
# alias Start='systemctl --user start'
# alias Status='systemctl --user status'
# alias Stop='systemctl --user stop'
# alias Restart='systemctl --user restart'
# alias Enable='systemctl --user enable'
# alias Disable='systemctl --user disable'

# arch linux
#alias P=yay
#alias Pu="yay -Syyu"
#alias pacman-autoremove='sudo pacman -Rcns $(pacman -Qdtq)'
#alias pacman-clean='sudo pacman -Scc'

alias steam='LIBGL_DEBUG=verbose LD_PRELOAD="/usr/\$LIB/libstdc++.so.6 /usr/$LIB/libgcc_s.so.1 /usr/$LIB/libxcb.so.1" steam'

alias whatisall='whatis $(compgen -c) | sort'

alias dice='echo $((0x$(head -c5 /dev/random|xxd -ps)%6+1))'
alias zip-parts='echo "Repairing zip volume into archive_repaired.zip" && zip --output archive_repaired.zip -F'
alias jsonvalid='python -mjson.tool'

# alias codename='code=$(curl -G http://codenames.herokuapp.com/api/codenames -d lists=adjectives,cities  -d filters=alliterative,random 2>/dev/null); echo $code; echo $code | xclip -i'

# }}}
# functions {{{

function gp {
    ps -ef "$1" | grep -v grep
}

function mp3tomid {
    for f in "$@"; do
        mp3="$f"
        wav="${f%.mp3}.wav"
        midi="${f%.mp3}.mid"
        echo "===> Converting $mp3 to $midi"
        ffmpeg -i "$mp3" "$wav"
        waon -i "$wav" -o "$midi"
        rm "$wav"
    done
}

function md2doc {
    in="$1"
    out="${in}.docx" 
    html=$(mktemp)
    pandoc -f gfm -t html -o "$html" --wrap=none "$in"
    pandoc -f html -t docx -o "$out" --wrap=none "$html"
    rm -f "$html"
}

function md2wp {
    in="$1"
    out="${in}.wp"
    pandoc -f gfm -t markdown_phpextra+hard_line_breaks-citations-markdown_in_html_blocks --embed-resources --wrap=none -o "$out" "$in"
}

# }}}
# enhancements {{{

# use \ to invoke the original command, eg \cat

if which bat >/dev/null 2>&1; then
    alias cat=bat
fi

if which prettyping >/dev/null 2>&1; then
    alias ping=prettyping
fi

if which htop >/dev/null 2>&1; then
    alias top=htop
fi

# }}}


# vim: fdm=marker
